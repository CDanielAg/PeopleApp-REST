version: '3.8'

services:
  db:
    image: mysql:8.0
    container_name: peopleapp_db
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: "rootpassword"
      MYSQL_DATABASE: "people"
      MYSQL_USER: "upeople"
      MYSQL_PASSWORD: "1234"
    volumes:
      - db_data:/var/lib/mysql
      - ./create_db.sql:/docker-entrypoint-initdb.d/create_db.sql:ro
    # Si necesitas conectar al puerto MySQL desde el host activa la l√≠nea siguiente
    # ports:
    #   - "3306:3306"

  web:
    build: .
    container_name: peopleapp_web
    depends_on:
      - db
    ports:
      # Bind container port 80 to host loopback so you can use http://127.0.0.1
      - "127.0.0.1:80:80"
    volumes:
      - ./:/var/www/html:cached
    environment:
      APACHE_RUN_USER: "www-data"
      APACHE_RUN_GROUP: "www-data"
      DB_HOST: "peopleapp_db"
      DB_NAME: "people"
      DB_USER: "upeople"
      DB_PASS: "1234"

volumes:
  db_data:
